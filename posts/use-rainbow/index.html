<!doctype html><html lang="en">
<!-- Mirrored from sonnet.io/posts/use-rainbow/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 11 Nov 2024 20:29:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta name="theme-color" content="#fff4f4"><link href="../../css/styles.css" rel="stylesheet"><link href="https://fonts.gstatic.com/" rel="preconnect"><link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&amp;display=swap" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="../../feed.xml" title="Rafał Pastuszak"><meta property="og:description" content="A quick note about the rainbow effect used on potato.horse and colour spaces
"><meta property="og:title" content="useRainbow() · Rafał Pastuszak"><meta property="og:site_name" content="sonnet.io"><meta property="og:url" content="index.html"><meta property="og:image" content="../../images/hero/use-rainbow-social.jpg"><meta property="og:image:width" content="400"><meta property="og:image:height" content="400"><meta property="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@rafalpast"><meta name="twitter:creator" content="@rafalpast"><meta name="twitter:title" content="useRainbow() · Rafał Pastuszak"><meta name="twitter:description" content="A quick note about the rainbow effect used on potato.horse and colour spaces
"><meta name="twitter:image" content="../../images/hero/use-rainbow-social.jpg"><title>useRainbow() · Rafał Pastuszak</title><meta name="description" content="A quick note about the rainbow effect used on potato.horse and colour spaces
"><link rel="apple-touch-icon" sizes="180x180" href="../../images/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../../images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../../images/favicons/favicon-16x16.png"><link rel="manifest" href="../../images/favicons/site.webmanifest"><meta name="msapplication-config" content="../../images/favicons/browserconfig.xml"><meta name="msapplication-TileColor" content="#ffffff"><meta name="theme-color" content="#ffffff"><script>document.addEventListener("DOMContentLoaded", () => {
        const remoteLinks = document.querySelectorAll('a[href^="//"], a[href^="http"]');

        [...remoteLinks].forEach((anchor) => {
          anchor.target = "_blank";
        });
      });</script></head><body><main class="wrapper"><header class="blog-header" id="blog-header"><a href="../../index.html" class="blog-header__logo"></a><nav><a href="../../index.html" class="blog-header__logo"></a><ul id="menu" aria-labelledby="show-menu-button"><li><a href="../../blog">Writing</a></li><li><a href="../../projects">Projects</a></li><li><a href="https://untested.sonnet.io/">Notes</a></li><li><a href="https://consulting.sonnet.io/">Work with me</a></li><li><a href="../hi">Say&nbsp;hi</a></li></ul><button class="hide-menu" onclick='document.dispatchEvent(new CustomEvent("menu:close"))' arial-label="close menu"></button></nav><button class="show-menu" id="show-menu-button" arial-label="show menu" aria-expanded="false" onclick='document.dispatchEvent(new CustomEvent("menu:open"))'>menu</button></header><script type="module">[...document.querySelectorAll('#menu a')]
    .forEach( el => {
      el.addEventListener('click', () =>{
        if(el.getAttribute('href').startsWith('http')) {
          document.dispatchEvent(new CustomEvent('menu:close'))
        }
      })
    } 
  )

  document.addEventListener('menu:close', () => {
    document
      .querySelector('#blog-header')
      .classList
      .remove('is-visible');

    document.querySelector('#show-menu-button').setAttribute('aria-expanded', 'false')

  })

  document.addEventListener('menu:open', () => {
    document
      .querySelector('#blog-header')
      .classList
      .add('is-visible')

      document.querySelector('#show-menu-button').setAttribute('aria-expanded', 'true')
  })</script><div class="container container--full"><article class="post"><header class="post__header"><picture><source type="image/avif" srcset="/images/opt/KLx9IAq0xu-600.avif 600w, /images/opt/KLx9IAq0xu-1200.avif 1200w" sizes="(min-width: 1200px) 60rem, 100vw"><source type="image/webp" srcset="/images/opt/KLx9IAq0xu-600.webp 600w, /images/opt/KLx9IAq0xu-1200.webp 1200w" sizes="(min-width: 1200px) 60rem, 100vw"><source type="image/jpeg" srcset="/images/opt/KLx9IAq0xu-600.jpeg 600w, /images/opt/KLx9IAq0xu-1200.jpeg 1200w" sizes="(min-width: 1200px) 60rem, 100vw"><img alt="useRainbow()" loading="lazy" decoding="async" src="../../images/opt/KLx9IAq0xu-600.jpeg" width="1200" height="743"></picture><time class="post__time" datetime="Thu Nov 18 2021 00:00:00 GMT+0000 (Coordinated Universal Time)">Nov 18, 2021</time><h1 class="post__title">useRainbow()</h1></header><div class="post__content"><p>Hi there! It's been a long time, I know. I took a break from work and started working on some small, personal projects (toys).</p><p>One of those small projects is <a href="https://potato.horse/">potato.horse</a> where I keep all of my doodles, visual short stories and jokes. Check it out!</p><p>However, this post is not about my break from work, other experiments, or the site itself. People seem to like one particular technique I used in the design, notably, the backround effect applied when the user browses the content:</p><p><video src="../../images/use-rainbow/use-rainbow-scroll-animation.mp4" muted autoplay loop controls></video></p><p>Some asked me how this effect was implemented (including going as far as reading the minified code, which is very flattering).</p><p>So, here's a quick gist, followed up with some context:</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useRainbowBg</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> <span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>            <span class="token keyword">const</span> viewportHeight <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<br>            <span class="token keyword">const</span> contentHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<br>            <span class="token keyword">const</span> viewportsPerRotation <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><br>                <span class="token number">3</span><span class="token punctuation">,</span><br>                contentHeight <span class="token operator">/</span> viewportHeight<br>            <span class="token punctuation">)</span><br>            <span class="token keyword">const</span> from <span class="token operator">=</span> <span class="token number">51</span><br>            <span class="token keyword">const</span> progress <span class="token operator">=</span><br>                window<span class="token punctuation">.</span>scrollY <span class="token operator">/</span> <span class="token punctuation">(</span>viewportHeight <span class="token operator">*</span> viewportsPerRotation<span class="token punctuation">)</span><br>            <span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token punctuation">(</span>from <span class="token operator">+</span> <span class="token number">360</span> <span class="token operator">*</span> progress<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">360</span><br><br>            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hsl(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>h<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg, 100%, 50%)</span><span class="token template-punctuation string">`</span></span><br>        <span class="token punctuation">}</span><br>        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>In short, I map the <em>scroll position</em> into the <em>hue</em> in the HSL colour notation. Let's break this down.</p><h3>Colour models</h3><p>There are many ways of describing colours in CSS, with the two most common ones being RGB (left) and HSL (right):</p><div class="embed example-rgb-hsl"></div><p>RGB is an additive colour palette. This means that mixing 100% of red, green and blue will produce white, mixing 100% red and 100% green but 0% blue, will produce yellow and so on. This is different from, say, using oil paint or the <a href="https://en.wikipedia.org/wiki/CMYK_color_model">CMYK colour model</a>, where the resulting tone would be black(-ish)<a href="#footnote-1" class="footnote">1</a>.</p><p>We're used to this approach because it's easy to describe in code but specifying colours in terms of hue, saturation and luminosity seems more natural, especially if you come from a design background, or... you know, are a human being using a human language.</p><p>We've gotten used to RGB as developers, but in spoken language using it would feel unnatural and confusing. <a href="http://facade.photo/">Façade</a> would be very hard to use in RGB.</p><p>On the other hand, HSL can often be much more intuitive to work with. For instance if I want to make a colour slightly colder, I can just move the hue slider a bit towards blue and I should get closer to what I have in mind. With RGB if we make the colour appear colder by including more blue, the resulting tone will be a bit brighter as the blue component contributes to the overall lightness. This means that you'd have to lower the red and green values to compensate.</p><p>To see how this works in practice, try maxing out the blue colour in the example below.</p><div class="embed example-hue-shift-rgb"></div><p>The first thing that stands out is that all tones are shifted towards blue and the overall brightness of the picture is increased. In the case of the effect we're discussing, that would be undesirable.</p><p>Now, let's try to do the same with the HSL colour circle. Drag the slider to the left, by <strong>ca. 90 degrees:</strong></p><div class="embed example-hue-shift-hsl"></div><p>In this scenario using HSL not only <em>turns Susan into a vampire</em>, but also maintains a similar<a href="#footnote-2" class="footnote">2</a> level of brightness. And that's exactly what I'm looking for.</p><p>So, what did I mean by saying:</p><blockquote><p>How does this work? In short, I map the <em>scroll position</em> into the <em>hue</em> in the HSL colour notation. <cite>Rafal, 2 days earlier</cite></p></blockquote><p>I meant that every time we detect a scroll event, I try to map it to an angle on the hue circle:</p><div class="embed example-scroll"></div><p>I didn't want to start with red as it would make me hungry and the base yellow fits the design a bit better, so I applied a small initial shift, hence <code>const from = 51</code> set as the initial offset.</p><p>And, as far as the basic implementation goes, that's it!</p><p>Now, there are three other areas of improvement:</p><h3>Performance</h3><p>We're triggering a repaint on every scroll, so I was a bit worried that older mobile devices, or even some hi-end laptops plugged in to 4k screens might not be able to maintain solid 60fps. But, I'm happy with the results so far. Using <a href="http://developers.google.com/web/updates/2016/06/passive-event-listeners">passive event listeners</a> provided a bit of a boost, especially on mobile.</p><p>When/if I realise that performance is a problem, especially with more content down the line, I'll probably focus on these areas first:</p><ul><li>removing the unnecessary call to <code>getBoundingClientRect</code> on every scroll handler call</li><li>deferring or throttling background colour changes using <code>requestAnimationFrame</code></li></ul><p>I expect the first improvement to have some impact, but the benefits of the second one should be negligible.</p><p>Measure before optimising. Obsessing about the performance only makes sense when issues become noticeable, be it through a drop in framerate or battery impact. Your iPhone Pro has more computing power than many low-end laptops, so it's a good idea to test on those devices too. It's good to have a crappy old Android phone exacly for that purpose if you can spare a few quid.</p><h3>Perceptually uniform colour spaces</h3><p>You might've noticed that in the previous illustrations some fully saturated colours seemed darker than the others. That's because the colour spaces we use normally when coding don't reflect the way the human eye works. I'll leave the in-depth explanation to <a href="https://programmingdesignsystems.com/color/perceptually-uniform-color-spaces/">someone much more experienced than me</a>, but suffice to say (gross oversimplification alert!) that generally the same amount of red/green/yellow will appear brighter than blue. This means that in some cases the text on the page will be harder to read.</p><div class="use-rainbow__rainbow"><div class="use-rainbow__column use-rainbow__column--hsl"><div class="use-rainbow__column-title">HSL<br>⬇</div><div class="use-rainbow__swatches"><div style="background-color: hsl(0, 90%, 60%)"></div><div style="background-color: hsl(24, 90%, 60%)"></div><div style="background-color: hsl(48, 90%, 60%)"></div><div style="background-color: hsl(72, 90%, 60%)"></div><div style="background-color: hsl(96, 90%, 60%)"></div><div style="background-color: hsl(120, 90%, 60%)"></div><div style="background-color: hsl(144, 90%, 60%)"></div><div style="background-color: hsl(168, 90%, 60%)"></div><div style="background-color: hsl(192, 90%, 60%)"></div><div style="background-color: hsl(216, 90%, 60%)"></div><div style="background-color: hsl(240, 90%, 60%)"></div><div style="background-color: hsl(264, 90%, 60%)"></div><div style="background-color: hsl(288, 90%, 60%)"></div><div style="background-color: hsl(312, 90%, 60%)"></div><div style="background-color: hsl(336, 90%, 60%)"></div></div></div><div class="use-rainbow__column use-rainbow__column--hsluv"><div class="use-rainbow__swatches"><div style="background-color: #f75782"></div><div style="background-color: #eb6a2c"></div><div style="background-color: #c0852b"></div><div style="background-color: #a5902b"></div><div style="background-color: #88992b"></div><div style="background-color: #56a22b"></div><div style="background-color: #2da46b"></div><div style="background-color: #2ea28b"></div><div style="background-color: #2fa09f"></div><div style="background-color: #319db4"></div><div style="background-color: #3498d6"></div><div style="background-color: #7e86f4"></div><div style="background-color: #c16af4"></div><div style="background-color: #f43ae8"></div><div style="background-color: #f64cb6"></div></div><div class="use-rainbow__column-title">⬆<br>HSLUV (perceptually uniform)</div></div></div><p><em>For now</em>, this isn't an issue as I've <em>just</em> put this thing online and titles serve a secondary purpose. But there's a solution to the problem and it's not overly complicated: use a perceptually uniform colour space. There's a bunch of libraries that do it out of the box, both in JS/TS and CSS/SASS/<code>&lt;pick your CSS flavour here&gt;</code>. <a href="https://www.hsluv.org/"><code>hsluv</code></a> seems like a good starting point.</p><h3>Accessibility</h3><p>Note that I'll be focusing on the visual effect itself and not discussing the rest of the site (e.g. alt tags, document structure, etc...). I'd like to focus on contrast, colour blindness and people who rely on <code>prefers-reduced-motion</code>. The site is a living document, there's always so much to improve. For instance, contrast can be an issue in a few, non-critical places. I'm happy to accept feedback and implement it: <a href="../hi">hit me up!</a>.</p><h3>Colour blindness</h3><p>I wanted to make sure that the effect doesn't break the site completely for people with colour blindness. So I focused on the most common types: Deuteranomaly and Protanomaly (red-green colour blindness), but also ran wider tests. I used Photoshop and <a href="https://github.com/oftheheadland/Colorblindly">Colorblindly (Chrome extension)</a> for some rudimentary checks.</p><h3><code>prefers-reduced-motion</code></h3><blockquote><p>The <strong>prefers-reduced-motion</strong> CSS media feature is used to detect if the user has requested that the system minimize the amount of non-essential motion it uses. <cite><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion">MDN</a></cite></p></blockquote><p>This site doesn't contain many animations (besides the <em>Little Sausage Angels</em> you'll see if you hit 'Share'), but I was wondering if people who rely on <code>prefers-reduced-motion</code> would like the background colour to stay constant.</p><p>The short answer is: I don't know. My intuition is that rotating colours doesn't really qualify as motion, but my experience and understanding of the problem is, to say the least, limited. In situations like this I'd rather depend on user research instead of guesses.</p><p>Luckily, the site had its five minutes of fame on Reddit which proved to be a decent opportunity to collect feedback. None of the users brought up an issue with the background effect so far. I'm also lucky enough to know a bunch of accessibility specialists, such as <a href="https://twitter.com/a_sandrina_p">Sandrina Pereira</a>. Her suggestion was that a) background animations definitely qualify as motion, b) perhaps the effect feels natural because it's a direct result of a user interaction.</p><h2>Summary</h2><p>The late 90s/Geocities web felt playful and weird. It was fun in an uninhibited, somewhat less performative, way. I wanted to incorporate some of this look and feel in the site. But still, I didn't want to make it feel esoteric to the point where you'd need to up your hipsterdom-level to 9000 and browse it exclusively throught Netscape 7. All of that, while listening to the new Nirvana: Unplugged.</p><p>I still wanted decent UX on mobile and desktop, and some space for easter eggs (something you can't do when living in the strange and abusive relationship with social media we've grown so accustomed to).</p><p>As a kid I had build 6 websites before I even got access to the Internet for the first time. Now, after being burned out for 3 years, even considering changing my job, it was the first time I genuinely enjoyed coding. Fuck, I forgot how much fun it was.</p><p>Now, go out, pet your cat and make some shit!</p><hr><p>PS. Check <a href="https://www.cameronsworld.net/">https://www.cameronsworld.net/</a></p><p>PPS. The code for interactive diagrams can be found <a href="https://github.com/paprikka/use-rainbow-article-examples">here</a></p><h3>Footnotes</h3><ol><li><span id="footnote-1"></span>hence the K component in CMYK meaning black. Using B would be confusing as it means blue in other colour models.</li><li><span id="footnote-2"></span>it's not perfect, since the perceptual colour space differs from what's described using RGB/HSL.</li></ol><style>@import '../../js/use-rainbow/style.css';
    .use-rainbow__rainbow{
        display: flex;
        flex-direction: column;
    }
    .use-rainbow__column-title {
        text-align: center;
        font-size: 2rem;
        font-weight: 500;
        line-height: calc(var(--ru) * 2rem);
        margin: calc(var(--ru) * 1rem) 0;
     }
    .use-rainbow__swatches {
        display: flex;
        justify-content: space-between;
    }
    .use-rainbow__swatches div {
        height: 3rem;
        flex: 1;
    }
    .example-hue-shift-rgb, .example-hue-shift-hsl {
        max-width: 35rem;
        margin-left: auto;
        margin-right: auto;
    }</style><script src="https://unpkg.com/preact?umd"></script><script src="../../js/use-rainbow/examples.umd.js"></script><script type="module">Examples.mountExample(Examples.ExampleRGBHSL, '.example-rgb-hsl')
    Examples.mountExample(Examples.ExampleScroll, '.example-scroll')
    Examples.mountExample(Examples.ExampleHueShiftRGB, '.example-hue-shift-rgb')
    Examples.mountExample(Examples.ExampleHueShiftHSL, '.example-hue-shift-hsl')</script></div></article><aside class="sharing">Did you enjoy the article? Then **subscribe to my mailing list** to receive more content like this:<div class="sharing__email"><script async data-uid="af1fc0f370" src="https://rafal.ck.page/af1fc0f370/index.js"></script></div>You can also <a href="https://rafal.ck.page/products/tip">buy me a coffee</a>, <a href="../../feed.xml">subscribe via RSS</a>, or <a href="../hi">say&nbsp;hi</a>.</aside><nav class="post__nav"><a href="../../blog">Go back to all posts</a></nav></div></main><script async defer="defer" data-domains="www.sonnet.io,sonnet.io" data-website-id="fbde7cb0-26f1-44d4-ba49-2423c13314a6" src="https://sonnet-events.vercel.app/umami.js"></script><script>document.addEventListener('click', function(event) {
            let target = event.target;
            while (target && target !== document) {
                if (target.hasAttribute('data-sonnet-event')) {
                    const eventName = target.getAttribute('data-sonnet-event');
                    umami.trackEvent(eventName);
                    break;
                }
                target = target.parentElement;
            }
        });</script><script>__sonnet_build_time="Fri Jun 14 2024 10:28:17 GMT+0000 (Coordinated Universal Time)"</script><a rel="me" hidden href="https://mastodon.cloud/@raf">Mastodon</a></body>
<!-- Mirrored from sonnet.io/posts/use-rainbow/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 11 Nov 2024 20:29:25 GMT -->
</html>